<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ —Å AI</title>
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- –¶–≤–µ—Ç —Ç–µ–º—ã –¥–ª—è –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ -->
    <meta name="theme-color" content="#2c3e50">
    
    <!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è iOS (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, —Ö–æ—Ç—è –≤—ã —Å–ø—Ä–∞—à–∏–≤–∞–ª–∏ –ø—Ä–æ Android) -->
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-512.png') }}">

    <!-- –í–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ CSS -->
    <style>
        /* ... –≤–∞—à–∏ —Å—Ç–∏–ª–∏ ... */
        body { font-family: sans-serif; text-align: center; background-color: #f4f4f9; }
        .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; max-width: 300px; margin: 20px auto; }
        .cell { width: 100px; height: 100px; background: white; border: 2px solid #333; font-size: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .cell.taken { cursor: not-allowed; }
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; background: #2c3e50; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h1>

        <!-- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ -->
        <div id="mode-select">
            <button onclick="startGame('1p')">–ò–≥—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ AI</button>
            <button onclick="startGame('2p')">2 –∏–≥—Ä–æ–∫–∞</button>
        </div>

        <div id="game-area" style="display: none;">
            <div id="status">–•–æ–¥–∏—Ç: <span id="player">X</span></div>
            <div class="board" id="board"></div>
            <button id="resetBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>

    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/static/sw.js')
                .then(reg => console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', reg))
                .catch(err => console.log('–û—à–∏–±–∫–∞ SW:', err));
            });
    
        }
    </script>
    
    <!-- –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π JS –∫–æ–¥ –∏–≥—Ä—ã -->
    <script>
        // ... –≤–µ—Å—å –≤–∞—à —Ç–µ–∫—É—â–∏–π JavaScript –∫–æ–¥ –∏–≥—Ä—ã ...
        // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω –∑–¥–µ—Å—å –∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞ <script>
    </script>

    <script>
        let currentMode = null;

        function startGame(mode) {
            currentMode = mode;
            fetch('/new_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode: mode })
            }).then(() => {
                document.getElementById('mode-select').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';
                document.getElementById('player').textContent = 'X';
                initBoard();
            });
        }

        function initBoard() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', () => handleCellClick(i));
                boardEl.appendChild(cell);
            }
        }

        function renderBoard(board) {
            for (let i = 0; i < 9; i++) {
                document.querySelector(`.cell[data-index="${i}"]`).textContent = board[i];
            }
        }

        async function handleCellClick(index) {
            const response = await fetch('/move', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cell: index })
            });
            const data = await response.json();

            if (data.error) {
                alert(data.error);
                return;
            }

            renderBoard(data.board);

            if (data.status === 'win') {
                document.getElementById('status').textContent = `–ü–æ–±–µ–¥–∏–ª: ${data.winner}!`;
                disableCells();
            } else if (data.status === 'draw') {
                document.getElementById('status').textContent = '–ù–∏—á—å—è!';
                disableCells();
            } else {
                if (currentMode === '2p') {
                    document.getElementById('player').textContent = data.current_player;
                } else {
                    // –í —Ä–µ–∂–∏–º–µ 1p –ø–æ—Å–ª–µ —Ö–æ–¥–∞ —á–µ–ª–æ–≤–µ–∫–∞ –∏–¥—ë—Ç —Ö–æ–¥ AI
                    // –°—Ç–∞—Ç—É—Å –æ—Å—Ç–∞—ë—Ç—Å—è "–•–æ–¥–∏—Ç: X", –ø–æ—Ç–æ–º—É —á—Ç–æ AI —Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    // –ù–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ–º ‚Äî —á–µ–ª–æ–≤–µ–∫ –∂–¥—ë—Ç —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥–∏
                }
            }
        }

        function disableCells() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.style.pointerEvents = 'none';
            });
        }

        document.getElementById('resetBtn').addEventListener('click', () => {
            location.reload();
        });
    </script>
</body>

</html>
